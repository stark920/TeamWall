import{_ as J,a as u,c as p,d as l,r as c,t as k,h as L,i as Q,n as x,F as P,e as E,j as $,k as j,b as w,l as X,A as Y,u as Z,m as ee,p as se,f as T,q as U,I as te,s as ae,w as A,x as le,y as F,z as ne,B as re,v as H,C as oe}from"./index.e7c7c9fd.js";import{_ as q}from"./UserInfo.e4a1d393.js";import{a as ue}from"./apiLike.11c892ec.js";const ie={},ce={class:"h-5 w-5",viewBox:"0 0 24 24",fill:"currentColor",stroke:"white","stroke-width":"1","stroke-linecap":"round","stroke-linejoin":"round"},de=l("path",{d:"M14 9V5a3 3 0 0 0-3-3l-4 9v11h11.28a2 2 0 0 0 2-1.7l1.38-9a2 2 0 0 0-2-2.3zM7 22H4a2 2 0 0 1-2-2v-7a2 2 0 0 1 2-2h3"},null,-1),me=[de];function ve(r,o){return u(),p("svg",ce,me)}var pe=J(ie,[["render",ve]]);const ge={class:"overflow-hidden rounded-lg border-2 border-black"},he=["onClick"],fe=["src"],_e={key:0,class:"absolute top-0 left-0 flex h-full w-full items-center justify-center bg-black bg-opacity-40"},be={class:"text-3xl text-white"},we={props:{images:{type:Array,default(){return[]}}},setup(r){const o=r,m=c(!1),f=c(0),e=c(k(o.images).map(i=>i.url));L(o,i=>{e.value=k(i.images).map(v=>v.url)});const s=c(k(o.post));L(o,i=>{s.value=k(i.post)});const y=i=>{f.value=i,m.value=!0},g=()=>{m.value=!1};return(i,v)=>{const h=Q("vue-easy-lightbox");return u(),p(P,null,[l("div",ge,[l("div",{class:x(["grid gap-0",{"grid-cols-1":e.value.length<=2,"grid-cols-2":e.value.length==3,"grid-cols-3":e.value.length==4,"max-h-96 grid-flow-col grid-rows-6":e.value.length>=5}])},[(u(!0),p(P,null,E(e.value,(I,d)=>(u(),p(P,{key:I.id},[d<5?(u(),p("div",{key:0,onClick:B=>y(d),class:x(["cursor-pointer",{"col-span-2":e.value.length==3&&d==0,"col-span-3":e.value.length==4&&d==0,"row-span-3":e.value.length>=5&&d<2,"row-span-2":e.value.length>=5&&d>=2,relative:e.value.length>5&&d==4}])},[l("img",{src:I,class:x(["object-center",{"max-h-full":e.value.length==1,"max-h-48":e.value.length==2||e.value.length==3||e.value.length==4}])},null,10,fe),e.value.length>5&&d==4?(u(),p("div",_e,[l("span",be,$(`+ ${e.value.length-5}`),1)])):j("",!0)],10,he)):j("",!0)],64))),128))],2)]),w(h,{visible:m.value,imgs:e.value,index:f.value,onHide:g},null,8,["visible","imgs","index"])],64)}}},S=X.create({baseURL:`${Y}/comment`,timeout:2e4}),K=()=>localStorage.getItem("metaWall")?{headers:{Authorization:localStorage.getItem("metaWall")}}:!1;S.interceptors.response.use(function(r){return r},function(r){const o=r.response.data;return Promise.reject(o)});const W={get:r=>S.get(`/${r}`,K()),send:(r,o)=>S.post(`/${r}`,o,K())},ke={class:"rounded-lg border-2 border-black bg-white p-6 shadow-post"},xe={class:"mb-4 whitespace-pre-wrap"},ye=["disabled"],$e={class:"flex w-full border-2 border-black"},Ie=["disabled"],Ce=l("span",null,"\u7559\u8A00",-1),Ue={class:"whitespace-pre"},Le={props:{post:{type:Object,default:()=>{}}},setup(r){const o=r,m=Z(),f=ee(),e=c(!1),s=c(k(o.post));L(o,a=>{s.value=k(a.post)});const y=c(s.value.comments),g=c(!1),i=c(!1),v=c(!1),h=c(""),I=a=>{e.value=!0;const t={posts:a};ue.toggle(t).then(()=>{d(f.user.id),e.value=!1}).catch(()=>{m.error("\u9023\u7DDA\u7570\u5E38\uFF0C\u8ACB\u7A0D\u5F8C\u518D\u8A66"),e.value=!1})},d=a=>{if(s.value.likes.includes(a)){const _=s.value.likes.findIndex(b=>b===a);s.value.likes.splice(_,1)}else s.value.likes.push(a)},B=a=>{g.value||(g.value=!0,W.get(a).then(t=>{y.value=t.data.data,i.value=!0,g.value=!1}).catch(()=>{m.error("\u53D6\u5F97\u7559\u8A00\u5931\u6557\uFF0C\u8ACB\u7A0D\u5F8C\u518D\u8A66"),g.value=!1}))},V=a=>{if(h.value.trim()===""){m.error("\u60A8\u5C1A\u672A\u8F38\u5165\u4EFB\u4F55\u8A0A\u606F");return}v.value=!0,W.send(a,{content:h.value}).then(t=>{G(t.data.data),m.success("\u65B0\u589E\u7559\u8A00\u6210\u529F"),h.value="",v.value=!1}).catch(()=>{m.error("\u7559\u8A00\u5931\u6557\uFF0C\u8ACB\u7A0D\u5F8C\u518D\u8A66"),v.value=!1})},G=a=>{const t={content:a.content,userId:{_id:a.userId._id,name:a.userId.name,avatar:{url:a.userId.avatar.url}},createdAt:a.createdAt};y.value.push(t)},O=se(()=>y.value.sort((t,_)=>{const b=new Date(t.createdAt),C=new Date(_.createdAt);return b-C}));return(a,t)=>{var _,b,C,z,D,N,M;return u(),p("div",ke,[w(q,{class:"mb-4",imgUrl:(b=(_=s.value.userId)==null?void 0:_.avatar)==null?void 0:b.url,name:(C=s.value.userId)==null?void 0:C.name,userPageUrl:`/profile/${(z=s.value.userId)==null?void 0:z._id}`,subTitle:a.$filters.dateTime(s.value.createdAt)},null,8,["imgUrl","name","userPageUrl","subTitle"]),l("p",xe,$(s.value.content),1),((D=s.value.image)==null?void 0:D.length)>0?(u(),T(we,{key:0,images:s.value.image},null,8,["images"])):j("",!0),l("div",null,[l("button",{type:"button",class:x(["flex items-center justify-center py-5",{"cursor-not-allowed":e.value}]),onClick:t[0]||(t[0]=n=>I(s.value._id)),disabled:e.value},[(N=s.value.likes)!=null&&N.includes(U(f).user.id)?(u(),T(pe,{key:1,class:"mr-2 h-5 w-5 text-primary"})):(u(),T(te,{key:0,class:"mr-2 h-5 w-5 text-primary"})),l("span",null,$((M=s.value.likes)==null?void 0:M.length),1)],10,ye)]),l("div",{class:"mb-5 flex items-center",onKeyup:t[3]||(t[3]=ne(re(n=>V(s.value._id),["exact"]),["enter"]))},[w(ae,{class:"mx-2",size:"40",imgUrl:U(f).user.avatar},null,8,["imgUrl"]),l("div",$e,[A(l("input",{"onUpdate:modelValue":t[1]||(t[1]=n=>h.value=n),class:"w-full border-none focus:ring-2 focus:ring-primary",type:"text"},null,512),[[le,h.value]]),l("button",{class:x(["flex w-full max-w-[128px] items-center justify-center border-l-2 border-black bg-primary text-base text-white",{"cursor-not-allowed bg-slate-500":v.value}]),onClick:t[2]||(t[2]=n=>V(s.value._id)),disabled:v.value},[Ce,w(F,{class:x(["ml-1 h-4 w-4 animate-spin",{hidden:!v.value}])},null,8,["class"])],10,Ie)])],32),A(l("div",{class:"mb-4 inline-flex cursor-pointer items-center font-bold text-primary hover:underline",onClick:t[4]||(t[4]=n=>B(s.value._id))},[l("span",null,"\u67E5\u770B\u5176\u4ED6 "+$(s.value.commentsNum-1)+" \u5247\u8F03\u65E9\u7559\u8A00",1),A(w(F,{class:"ml-1 h-4 w-4 animate-spin"},null,512),[[H,g.value]])],512),[[H,s.value.commentsNum>1&&!i.value]]),(u(!0),p(P,null,E(U(O),n=>{var R;return u(),p("div",{class:"mb-4 rounded-lg bg-secondary p-4",key:n._id},[w(q,{class:"mb-4",imgUrl:(R=n.userId.avatar.url)!=null?R:n.userId.avatar,name:n.userId.name,userPageUrl:`/profile/${n.userId._id}`,subTitle:U(oe)(n.createdAt)},null,8,["imgUrl","name","userPageUrl","subTitle"]),l("p",Ue,$(n.content),1)])}),128))])}}};export{Le as _};
