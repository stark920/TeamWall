import{u as L,m as q,K as z,r as f,p as D,o as V,h as A,a as c,c as i,d as t,j as b,q as u,n as j,w,v as y,b as p,y as E,k as M,F as k,e as B,f as R,g as G,N as x}from"./index.115bb135.js";import{_ as K,a as T}from"./PostLoadingCard.6c08f197.js";import{P as H}from"./PostEmptyCard.64fe2149.js";import{_ as J}from"./PostCard.d5479862.js";import{u as O,a as Q}from"./useChat.8dad5d02.js";import{a as W}from"./apiPost.7f716322.js";import"./UserInfo.0e1998ed.js";import"./apiLike.8b169ff3.js";const X={class:"relative mb-4"},Y={class:"flex h-20 overflow-hidden rounded-lg border-2 border-black bg-white"},Z={class:"aspect-square h-full border-r-2 border-black"},ee=["src"],se={class:"flex w-full justify-between p-4"},te={key:0,class:"flex items-center justify-center"},ae=t("span",null,"\u50B3\u9001\u8A0A\u606F",-1),oe=t("div",{class:"absolute top-1 right-1 -z-10 h-full w-full rounded-lg border-2 border-black bg-white"},null,-1),le={key:0},re=t("p",{class:"p-8 text-center text-subtitle"}," \u76EE\u524D\u5C1A\u7121\u52D5\u614B\uFF0C\u65B0\u589E\u4E00\u5247\u8CBC\u6587\u5427\uFF01 ",-1),ve={setup(ne){const F=L(),P=q(),C=z(),d=f(C.params.id),h=f(!1),r=f(!0),{handleRoom:I}=O(),N=async()=>{var o;if(h.value)return;const e={receiver:d.value};try{h.value=!0;const s=await Q.room(e);if(!(s!=null&&s.status))return;I(s==null?void 0:s.data)}catch(s){const a=(o=s.response.data)==null?void 0:o.message;a&&F.error(a)}finally{h.value=!1}},S=f([]),v=(e=1,o="")=>{let s="new",a="";e===2&&(s="old"),e===3&&(a="hot"),W.getAll(`timeSort=${s}&search=${o}&likesSort=${a}&limit=9999`).then(n=>{r.value=!1,S.value=n.data.data}).catch(n=>{r.value=!1,console.log(n)})},_=D(()=>S.value.filter(e=>{var o;return((o=e.userId)==null?void 0:o._id)===d.value}));V(()=>{v()});const l=f({}),m=()=>{r.value=!0,x.getProfile(d.value).then(e=>{r.value=!1,l.value=e.data.data}).catch(e=>{r.value=!1,console.log(e)})},g=D(()=>{var s;return(l.value.followers?l.value.followers:[]).map(a=>a.user).includes((s=P.user)==null?void 0:s.id)});V(()=>{m()});const U=()=>{g.value?x.deleteFollow(l.value.id).then(()=>{m()}).catch(e=>{console.log(e)}):x.follow(l.value.id).then(()=>{m()}).catch(e=>{console.log(e)})};return A(C,e=>{e.name==="profile"&&e.params.id&&(d.value=e.params.id,v(),m())}),(e,o)=>{var s,a;return c(),i(k,null,[t("div",X,[t("div",Y,[t("div",Z,[t("img",{src:l.value.avatar,alt:"Avatar"},null,8,ee)]),t("div",se,[t("div",null,[t("h2",null,b(l.value.name),1),t("span",null,b((s=l.value.followers)==null?void 0:s.length)+" \u4EBA\u8FFD\u8E64",1)]),d.value!==((a=u(P).user)==null?void 0:a.id)?(c(),i("div",te,[t("button",{type:"button",class:j(["rounded-lg border-2 border-black px-8 py-1.5 shadow-post hover:bg-primary hover:text-white",u(g)?"bg-secondary":"bg-warning"]),onClick:U},b(u(g)?"\u53D6\u6D88\u8FFD\u8E64":"\u8FFD\u8E64"),3),t("button",{onClick:N,class:"ml-2 flex items-center justify-center rounded-lg border-2 border-black px-6 py-1.5 shadow-post hover:bg-gray-300"},[ae,w(p(E,{class:"ml-1 h-4 w-4 animate-spin"},null,512),[[y,h.value]])])])):M("",!0)])]),oe]),p(K,{onGetPosts:v}),w(t("ul",null,[(c(),i(k,null,B(3,n=>t("li",{key:n,class:"mb-4"},[p(T)])),64))],512),[[y,r.value]]),w(t("div",null,[u(_).length>0?(c(),i("ul",le,[(c(!0),i(k,null,B(u(_),(n,$)=>(c(),i("li",{key:$,class:j({"mb-4":$<u(_).length-1})},[p(J,{post:n},null,8,["post"])],2))),128))])):(c(),R(H,{key:1},{default:G(()=>[re]),_:1}))],512),[[y,!r.value]])],64)}}};export{ve as default};
