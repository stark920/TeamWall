import{a2 as C,a as d,c as p,d as a,b as _,q as n,s as L,j as m,u as k,M as B,r as $,a3 as y,o as j,Z as I,w as b,v as R,y as q,F as D,e as N,J as S,f as T}from"./index.e7c7c9fd.js";import{_ as U}from"./CardTitle.6005d03f.js";import{u as V,a as F}from"./useChat.34fb2727.js";const M={class:"flex items-center"},O={class:"flex-1 pl-3"},z={class:"font-bold"},A={class:"w-[200px] overflow-hidden overflow-ellipsis whitespace-nowrap text-sm text-slate-500 md:w-80"},E={class:"text-gray text-xs"},J={props:{room:{type:Object,required:!0,default:()=>{}}},setup(f){const l=f,{handleRoom:t}=V(),{name:r,message:c,avatar:u}=C(l.room),o=e=>e?new Date(e).toLocaleString():"\u5C1A\u672A\u958B\u59CB\u5C0D\u8A71",s=()=>{t(l.room)};return(e,i)=>{var h,g,x,w,v;return d(),p("li",{onClick:s,class:"shadow-normal mb-4 flex h-[77px] cursor-pointer items-center justify-between rounded-lg border-2 border-black bg-white px-4"},[a("div",M,[_(L,{size:"40",imgUrl:(h=n(u))==null?void 0:h.url},null,8,["imgUrl"]),a("div",O,[a("p",z,m(n(r)),1),a("p",A,m((x=(g=n(c))==null?void 0:g[0])==null?void 0:x.message),1)])]),a("span",E,m(o((v=(w=n(c))==null?void 0:w[0])==null?void 0:v.createdAt)),1)])}}},Z={class:"text-center"},G={class:"flex items-center justify-center pt-8"},H=S(" \u8F09\u5165\u4E2D "),W={setup(f){const l=k(),t=B([]),r=$(!0),c=({roomId:o,msg:s})=>{const e=t.findIndex(i=>i.roomId===o);e>-1&&(t[e].message=[s])};y.on("updateChatRecord",c);const u=async()=>{var o;try{r.value=!0;const s=await F.record(),{data:{status:e,chatRecord:i}}=s;e&&(Object.assign(t,i),console.log("chatList",t))}catch(s){const e=(o=s.response.data)==null?void 0:o.message;e&&l.error(e)}finally{r.value=!1}};return j(()=>{u()}),I(()=>{y.off("updateChatRecord",c)}),(o,s)=>(d(),p("section",null,[_(U,{title:"\u804A\u5929\u5BA4"}),a("ul",null,[b(a("li",Z," \u7121\u804A\u5929\u8A18\u9304 ",512),[[R,!r.value&&n(t).length===0]]),b(a("li",G,[H,_(q,{class:"ml-1 h-4 w-4 animate-spin"})],512),[[R,r.value]]),(d(!0),p(D,null,N(n(t),e=>(d(),T(J,{key:e==null?void 0:e.roomId,room:e},null,8,["room"]))),128))])]))}};export{W as default};
