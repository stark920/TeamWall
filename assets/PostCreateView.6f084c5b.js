import{u as I,L as j,r as v,M as S,a as g,c as m,b as w,d as o,w as p,x as T,q as i,n as C,v as h,F as b,e as L,k as z,j as D,B as F,y as N}from"./index.115bb135.js";import{_ as B}from"./CardTitle.ac88705d.js";import{a as H}from"./apiPost.7f716322.js";const M={class:"rounded-lg border-2 border-black bg-white p-8 shadow-post"},V=o("p",null,"\u8CBC\u6587\u5167\u5BB9",-1),P=o("label",{for:"customFileInput",class:"my-4 inline-block cursor-pointer rounded bg-black py-1 px-8 text-white"},"\u4E0A\u50B3\u5716\u7247",-1),R=["accept"],U={class:"text-gray-500"},E=["onClick"],q=["src"],A={class:"text-center"},O=["disabled"],G=o("span",null,"\u9001\u51FA\u8CBC\u6587",-1),X={setup(J){const c=I(),_=j(),l=v(),u=v(!1),a={contentLength:1,fileNum:10,fileSize:1024*1024,fileType:["image/jpg","image/jpeg","image/png"]},e=S({content:"",images:[],previews:[],warnHint:[]}),f={content(){return e.content.trim().length<a.contentLength?[`\u5167\u5BB9\u81F3\u5C11\u9700\u8981\u8F38\u5165 ${a.contentLength} \u500B\u5B57`]:null},file(s){const t=[];if(s.size>a.fileSize&&t.push(`${s.name}\uFF1A\u5716\u7247\u6A94\u6848\u904E\u5927\uFF0C\u50C5\u9650 ${a.fileSize/(1024*1024)} MB \u4EE5\u4E0B\u6A94\u6848`),a.fileType.indexOf(s.type)<0){const n=a.fileType.map(r=>r.split("/")[1]).join("\u3001");t.push(`${s.name}\uFF1A\u5716\u7247\u683C\u5F0F\u932F\u8AA4\uFF0C\u50C5\u9650 ${n} \u5716\u7247`)}return t.length>0?t:null}},y=s=>{if(!l.value.files)return;if(l.value.files.length+e.images.length>a.fileNum){c.error(`\u4E00\u5247\u8CBC\u6587\u6700\u591A\u53EF\u4EE5\u4E0A\u50B3 ${a.fileNum} \u5F35\u5716\u7247`),l.value=null,s.target.value=null;return}const t=[];for(const n of l.value.files){const r=f.file(n);if(r)t.push(...r);else{const d=new FileReader;d.onload=$=>{e.previews.push($.target.result)},d.readAsDataURL(n),e.images.push(n)}}l.value=null,s.target.value=null,t.length>0&&(e.warnHint=t,setTimeout(function(){e.warnHint.length=0},5e3))},k=s=>{e.previews.splice(s,1),e.images.splice(s,1)},x=()=>{if(u.value)return;const s=f.content();if(s){c.error(s.toString());return}u.value=!0;const t=new FormData;t.append("content",e.content),e.images.forEach(n=>{t.append("photos",n)}),H.upload(t).then(n=>{const r=n.data.data.userId;r?_.push(`/profile/${r}`):c.error("\u65B0\u589E\u8CBC\u6587\u5931\u6557\uFF0C\u8ACB\u7A0D\u5F8C\u518D\u8A66")}).catch(()=>{c.error("\u65B0\u589E\u8CBC\u6587\u5931\u6557\uFF0C\u8ACB\u7A0D\u5F8C\u518D\u8A66")})};return(s,t)=>(g(),m(b,null,[w(B,{title:"\u5F35\u8CBC\u52D5\u614B"}),o("div",M,[V,p(o("textarea",{rows:"10",placeholder:"\u8F38\u5165\u60A8\u7684\u8CBC\u6587\u5167\u5BB9",class:"mt-1 w-full resize-none border-2 px-4 py-3 focus:border-primary focus:shadow-transparent","onUpdate:modelValue":t[0]||(t[0]=n=>i(e).content=n)},null,512),[[T,i(e).content]]),P,o("input",{id:"customFileInput",ref_key:"uploadImages",ref:l,type:"file",accept:a.fileType.join(", "),class:"hidden",onChange:y,multiple:""},null,40,R),o("div",{class:C([{"items-center justify-center py-4":i(e).previews.length===0,"grid-cols-2":i(e).previews.length>1},"mb-4 grid w-full overflow-hidden rounded-lg border-2 border-black"])},[p(o("span",U," \u5C1A\u672A\u4E0A\u50B3\u5716\u7247 ",512),[[h,i(e).previews.length===0]]),i(e).previews.length>0?(g(!0),m(b,{key:0},L(i(e).previews,(n,r)=>(g(),m("div",{class:"relative aspect-video hover:brightness-110",key:r},[o("span",{onClick:d=>k(r),class:"absolute top-1 right-1 cursor-pointer rounded-md bg-white px-2 opacity-50 hover:opacity-100"}," \u79FB\u9664 ",8,E),o("img",{src:n},null,8,q)]))),128)):z("",!0)],2),o("div",A,[p(o("div",{class:"mb-4 whitespace-pre-wrap text-sm text-alert"},D(i(e).warnHint.join(`
`)),513),[[h,i(e).warnHint.length>0]]),o("button",{class:"mx-auto flex w-8/12 items-center justify-center rounded-lg border-2 border-black bg-subtitle py-3 font-semibold hover:bg-warning lg:w-6/12",onClick:t[1]||(t[1]=F(n=>x(),["prevent"])),disabled:u.value},[G,p(w(N,{class:"ml-1 h-4 w-4 animate-spin"},null,512),[[h,u.value]])],8,O)])])],64))}};export{X as default};
